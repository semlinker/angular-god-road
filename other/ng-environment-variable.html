<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>environment.ts 和 environment.prod.ts | Angular 修仙之路</title>
    <meta name="description" content="修炼 Angular、RxJS、TypeScript 秘籍">
    
    
    <link rel="preload" href="/angular-god-road/assets/css/styles.4eaf616f.css" as="style"><link rel="preload" href="/angular-god-road/assets/js/app.4eaf616f.js" as="script"><link rel="preload" href="/angular-god-road/assets/js/14.050d9df1.js" as="script"><link rel="prefetch" href="/angular-god-road/assets/css/1.styles.24fddc56.css"><link rel="prefetch" href="/angular-god-road/assets/css/2.styles.a2bd3099.css"><link rel="prefetch" href="/angular-god-road/assets/js/1.24fddc56.js"><link rel="prefetch" href="/angular-god-road/assets/js/10.edd26f16.js"><link rel="prefetch" href="/angular-god-road/assets/js/11.33f54712.js"><link rel="prefetch" href="/angular-god-road/assets/js/12.fcc87fd4.js"><link rel="prefetch" href="/angular-god-road/assets/js/13.fa6e9f88.js"><link rel="prefetch" href="/angular-god-road/assets/js/15.9f880834.js"><link rel="prefetch" href="/angular-god-road/assets/js/16.b96760bb.js"><link rel="prefetch" href="/angular-god-road/assets/js/17.13fefc8b.js"><link rel="prefetch" href="/angular-god-road/assets/js/18.c850d375.js"><link rel="prefetch" href="/angular-god-road/assets/js/19.7239064a.js"><link rel="prefetch" href="/angular-god-road/assets/js/2.a2bd3099.js"><link rel="prefetch" href="/angular-god-road/assets/js/20.4125efb9.js"><link rel="prefetch" href="/angular-god-road/assets/js/21.2a9e4d33.js"><link rel="prefetch" href="/angular-god-road/assets/js/22.f2cf7fbc.js"><link rel="prefetch" href="/angular-god-road/assets/js/23.7ff8e04e.js"><link rel="prefetch" href="/angular-god-road/assets/js/24.9f44b1b7.js"><link rel="prefetch" href="/angular-god-road/assets/js/25.0ec2854a.js"><link rel="prefetch" href="/angular-god-road/assets/js/26.7c66210d.js"><link rel="prefetch" href="/angular-god-road/assets/js/27.d9097f9d.js"><link rel="prefetch" href="/angular-god-road/assets/js/28.7d96a001.js"><link rel="prefetch" href="/angular-god-road/assets/js/29.4fc02651.js"><link rel="prefetch" href="/angular-god-road/assets/js/3.3d49ed81.js"><link rel="prefetch" href="/angular-god-road/assets/js/30.99a6671a.js"><link rel="prefetch" href="/angular-god-road/assets/js/31.2591ba92.js"><link rel="prefetch" href="/angular-god-road/assets/js/32.78ddd0be.js"><link rel="prefetch" href="/angular-god-road/assets/js/33.e9af0299.js"><link rel="prefetch" href="/angular-god-road/assets/js/34.c0d5a741.js"><link rel="prefetch" href="/angular-god-road/assets/js/35.284fb844.js"><link rel="prefetch" href="/angular-god-road/assets/js/36.1cb64f86.js"><link rel="prefetch" href="/angular-god-road/assets/js/37.b69ebefc.js"><link rel="prefetch" href="/angular-god-road/assets/js/38.048dd2ef.js"><link rel="prefetch" href="/angular-god-road/assets/js/39.9e4eec87.js"><link rel="prefetch" href="/angular-god-road/assets/js/4.ff267ab9.js"><link rel="prefetch" href="/angular-god-road/assets/js/40.9610211f.js"><link rel="prefetch" href="/angular-god-road/assets/js/41.ddd45347.js"><link rel="prefetch" href="/angular-god-road/assets/js/42.d2ebe819.js"><link rel="prefetch" href="/angular-god-road/assets/js/43.e1f5311e.js"><link rel="prefetch" href="/angular-god-road/assets/js/44.b5c3267a.js"><link rel="prefetch" href="/angular-god-road/assets/js/45.b34d49e9.js"><link rel="prefetch" href="/angular-god-road/assets/js/46.3602c3b6.js"><link rel="prefetch" href="/angular-god-road/assets/js/5.488dbe6d.js"><link rel="prefetch" href="/angular-god-road/assets/js/6.1c8c7528.js"><link rel="prefetch" href="/angular-god-road/assets/js/7.fc1d55b7.js"><link rel="prefetch" href="/angular-god-road/assets/js/8.0ebf2d9c.js"><link rel="prefetch" href="/angular-god-road/assets/js/9.dacb7e8b.js">
    <link rel="stylesheet" href="/angular-god-road/assets/css/1.styles.24fddc56.css"><link rel="stylesheet" href="/angular-god-road/assets/css/2.styles.a2bd3099.css"><link rel="stylesheet" href="/angular-god-road/assets/css/styles.4eaf616f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/angular-god-road/" class="home-link router-link-active"><!----> <span class="site-name">Angular 修仙之路</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/angular-god-road/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://semlinker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端修仙之路
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/semlinker" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/angular-god-road/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://semlinker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端修仙之路
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/semlinker" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>入门篇</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>工具篇</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>元素篇</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>其它</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/angular-god-road/other/ng-ctor-oninit.html" class="sidebar-link">Angular constructor vs ngOnInit</a></li><li><a href="/angular-god-road/other/ng-input-and-output.html" class="sidebar-link">Angular Input 和 Output</a></li><li><a href="/angular-god-road/other/ng-dom-abstract.html" class="sidebar-link">Angular DOM 抽象概述</a></li><li><a href="/angular-god-road/other/ng-comp-style.html" class="sidebar-link">Angular 组件样式</a></li><li><a href="/angular-god-road/other/ng-dynamic-component.html" class="sidebar-link">Angular 动态创建组件</a></li><li><a href="/angular-god-road/other/ng-environment-variable.html" class="active sidebar-link">Angular 环境变量</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/angular-god-road/other/ng-error-handler.html" class="sidebar-link">Angular 异常处理</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>RxJS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>RxJS</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><p>对于 “程序猿” 来说，在日常开发过程中，我们经常要与不同的开发环境打交道。在实际的项目的开发过程中，一般至少会有两个环境：开发环境和线上环境，这是很简单的情形。但对于一些项目来说，仅有两个环境是不够，除了开发环境和线上环境之外，可能还会包含测试环境和预发布环境等等。</p> <p>随着前后端分离开发方式的普及，越来越多的公司采用 Angular、React 和 Vue 等前端的 MV* 框架来开发 SPA 应用程序。因此对于前端开发者来说，需要不同的开发环境，其实主要是因为不同的环境对应不同的 API 接口地址。作为一个 Angular 的忠实粉丝，我们来介绍一下在 Angular 项目开发中，如何玩转 Angular 环境变量。</p> <h3 id="environment-ts-和-environment-prod-ts"><a href="#environment-ts-和-environment-prod-ts" aria-hidden="true" class="header-anchor">#</a> environment.ts 和 environment.prod.ts</h3> <p>在 <a href="https://www.npmjs.com/package/@angular/cli" target="_blank" rel="noopener noreferrer">Angular CLI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 发布后，越来越多的开发者都是使用 Angular CLI 来创建新的项目：</p> <div class="language-shell extra-class"><pre class="language-text"><code>$ ng new PROJECT-NAME
</code></pre></div><p>在执行上述命令后，在项目根目录的 <code>src/environments</code> 目录下会自动生成两个文件：environment.ts 和 environment.prod.ts 文件：</p> <ol><li>environment.ts</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> environment <span class="token operator">=</span> <span class="token punctuation">{</span>
  production<span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol><li>environment.prod.ts</li></ol> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> environment <span class="token operator">=</span> <span class="token punctuation">{</span>
  production<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>对于上面提到的需求，即不同环境使用不同的 API 接口地址，我们可以在不同的文件中设置不同的  API 接口地址，比如：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// environment.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> environment <span class="token operator">=</span> <span class="token punctuation">{</span>
  production<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  baseUrl<span class="token punctuation">:</span> <span class="token string">&quot;https://dev.semlinker.com&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// environment.prod.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> environment <span class="token operator">=</span> <span class="token punctuation">{</span>
  production<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  baseUrl<span class="token punctuation">:</span> <span class="token string">&quot;https://prod.semlinker.com&quot;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="https://www.npmjs.com/package/@angular/cli" target="_blank" rel="noopener noreferrer">Angular CLI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 除了自动生成上述两个文件之外，还会自动生成其它的文件，其中就包含 Angular 应用程序的入口文件 —— main.ts：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> enableProdMode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> platformBrowserDynamic <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/platform-browser-dynamic'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> AppModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app/app.module'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> environment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./environments/environment'</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>environment<span class="token punctuation">.</span>production<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">enableProdMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">platformBrowserDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bootstrapModule</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在上面代码中我们从 <code>./environments</code> 目录下导入  environment.ts 文件，然后根据 <code>environment.production</code> 属性的值，来决定是否启用 Prod 模式。那么现在问题来了，Angular 是怎么实现自动切换不同的开发环境呢？其实答案早已经公布在 <code>src/environments</code> 目录下 environment.ts 文件的注释中。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// This file can be replaced during build by using the `fileReplacements` array.</span>
<span class="token comment">// `ng build ---prod` replaces `environment.ts` with `environment.prod.ts`.</span>
<span class="token comment">// The list of file replacements can be found in `angular.json`.</span>
</code></pre></div><p>通过上面的注释，我们知道在执行 <code>ng build ---prod</code> 命令，进行项目构建的时候，会执行文件替换操作。而相应的文件替换规则，在 angular.json 文件中定义：</p> <div class="language-json extra-class"><pre class="language-json"><code> <span class="token property">&quot;architect&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;builder&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@angular-devkit/build-angular:browser&quot;</span><span class="token punctuation">,</span>
           //...
          <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;production&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;fileReplacements&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                  <span class="token property">&quot;replace&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/environments/environment.ts&quot;</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;with&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/environments/environment.prod.ts&quot;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token property">&quot;optimization&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此时我们已经知道 environment.ts 和 environment.prod.ts 文件的作用和 Angular 动态切换环境的实现方式。下面我们来介绍一下，如何处理两个以上的环境变量。假设因为项目需要，我们需要增加一个测试环境。</p> <h3 id="自定义环境"><a href="#自定义环境" aria-hidden="true" class="header-anchor">#</a> 自定义环境</h3> <p>首先我们先来新建一个 environment.test.ts 文件，并输入以下内容：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// environment.test.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> environment <span class="token operator">=</span> <span class="token punctuation">{</span>
  production<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  baseUrl<span class="token punctuation">:</span> <span class="token string">&quot;https://test.semlinker.com&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>然后打开项目中的 angular.json 文件，定位到 <strong>configurations</strong> 字段，具体路径为：<strong>projects -&gt; appname -&gt; architect -&gt; build -&gt; configurations</strong>，默认情况下只包含 &quot;production&quot; 属性：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;production&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;fileReplacements&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
         <span class="token punctuation">{</span>
           <span class="token property">&quot;replace&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/environments/environment.ts&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;with&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/environments/environment.prod.ts&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        // ...
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>下面我们复制一下  &quot;production&quot; 对象，然后把  &quot;production&quot; 属性名更改为 &quot;test&quot;，具体如下：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token string">&quot;test&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
   <span class="token string">&quot;fileReplacements&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
         <span class="token string">&quot;replace&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;src/environments/environment.ts&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;with&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;src/environments/environment.prod.ts&quot;</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;optimization&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">&quot;outputHashing&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sourceMap&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">&quot;extractCss&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">&quot;namedChunks&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">&quot;aot&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">&quot;extractLicenses&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">&quot;vendorChunk&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">&quot;buildOptimizer&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此时，我们已经成功一半了，接着我们还需要把 <strong>with</strong> 的属性值更新为 <strong>&quot;environment.test.ts&quot;</strong>。其实如果只是执行简单的替换文件操作，我们可以简单的进行配置，比如重新创建一个 mock 环境：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;mock&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;fileReplacements&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
         <span class="token property">&quot;replace&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/environments/environment.ts&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;with&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/environments/environment.mock.ts&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最后我们来测试一下，还记得在发布正式版本时，我们通过以下命令进行项目构建：</p> <div class="language-shell extra-class"><pre class="language-text"><code>$ ng build --prod
</code></pre></div><p>那么有的同学，可能想到对于构建测试环境的包，是不是只要运行：</p> <div class="language-shell extra-class"><pre class="language-text"><code>$ ng build --test
</code></pre></div><p>想象中很完美，但实际上并不是这样，ng build 命令并不支持 <code>--test</code> 参数，感兴趣的同学可以运行 <code>ng build --help</code> 命令查看 ng build 命令所支持的参数：</p> <div class="language-shell extra-class"><pre class="language-text"><code>usage: ng build &lt;project&gt; [options]
options:
  --aot
    Build using Ahead of Time compilation.
  --base-href
    Base url for the application being built.
  --build-optimizer
    Enables @angular-devkit/build-optimizer optimizations when using the 'aot' option.
  --configuration (-c)
    Specify the configuration to use.
    Enable and define the file watching poll time period in milliseconds.
  --prod
    Flag to set configuration to &quot;prod&quot;.
  --source-map
    Output sourcemaps.
  --stats-json
    Generates a 'stats.json' file which can be analyzed using tools such as: #webpack-bundle-analyzer' or https: //webpack.github.io/analyse.
</code></pre></div><p>其实 ng build 命令支持很多的参数，上面我们只是列出了常用的几个。可能有的同学已经注意到了 <code>--configuration</code> 这个参数，通常参数说明，我们知道这个参数用于指定构建时所使用的配置文件。没错，要达到我们预期的结果，就要利用该参数。不过在最终测试前，我们先来更新一下 main.ts 文件，增加一条输出日志：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>environment<span class="token punctuation">.</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>最后现在我们再来验证一下我们新创建的 test 环境是否生效：</p> <div class="language-shell extra-class"><pre class="language-text"><code>$ ng build --configuration=test
</code></pre></div><p>上述命令成功运行之后，就会在根目录下生成 <code>dist</code> 目录，并且在该目录下也会创建一个 <code>PROJECT-NAME</code> 目录。如果你本地已经安装了 python，可以进入该目录，然后在命令行执行：</p> <div class="language-shell extra-class"><pre class="language-text"><code>$ python -m SimpleHTTPServer
</code></pre></div><p>最后我们在浏览器中访问 <code>http://localhost:8000/</code> 地址，接着打开控制台，你将会看到以下输出信息：</p> <div class="language- extra-class"><pre class="language-text"><code>https://test.semlinker.com
</code></pre></div><p>其实如果验证的话，可以不用那么麻烦，我们可以使用 <code>ng serve</code> 命令，因为该命令也支持 <code>--configuration</code> 属性。不过与 <code>ng build</code> 命令一样，我们也需要配置一下 angular.json 文件：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;builder&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@angular-devkit/build-angular:dev-server&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;options&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;browserTarget&quot;</span><span class="token operator">:</span> <span class="token string">&quot;angular-storybook-demo:build&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;production&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token property">&quot;browserTarget&quot;</span><span class="token operator">:</span> <span class="token string">&quot;angular-storybook-demo:build:production&quot;</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;browserTarget&quot;</span><span class="token operator">:</span> <span class="token string">&quot;angular-storybook-demo:build:test&quot;</span>
        <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>之后，我们就可以在命令行运行以下的命令，来启用测试环境：</p> <div class="language-shell extra-class"><pre class="language-text"><code>$ ng serve --configuration=test
</code></pre></div><h3 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h3> <p>本文简单介绍了 Angular 项目中，environment.ts 和 environment.prod.ts 文件的作用和 Angular 动态切换环境的实现方式，此外后面我们还进一步介绍了如何自定义多个开发环境。掌握了本文所涉及的内容，基本上已经可以满足大多数项目的需求，对于上述的内容如果有遗漏的地方欢迎大家补充哈。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/angular-god-road/other/ng-dynamic-component.html" class="prev">
          Angular 动态创建组件
        </a></span> <span class="next"><a href="/angular-god-road/other/ng-error-handler.html">
          Angular 异常处理
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/angular-god-road/assets/js/14.050d9df1.js" defer></script><script src="/angular-god-road/assets/js/app.4eaf616f.js" defer></script>
  </body>
</html>
